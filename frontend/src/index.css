@import "tailwindcss";

/* ia-writer-mono-latin-400-normal */
@font-face {
  font-family: 'iA Writer Mono';
  font-style: normal;
  font-display: swap;
  font-weight: 400;
  src: url(https://cdn.jsdelivr.net/fontsource/fonts/ia-writer-mono@latest/latin-400-normal.woff2) format('woff2'), url(https://cdn.jsdelivr.net/fontsource/fonts/ia-writer-mono@latest/latin-400-normal.woff) format('woff');
}

@tailwind base;
@tailwind components;
@tailwind utilities;

/* 1) THEME TOKENS (underscored): defaults + classes control these */
@layer base {
  * {
    font-family: 'iA Writer Mono', monospace;
  }

  /* Light defaults */
  :root {
    color-scheme: light;
    --_background: 0 0% 100%;
    --_foreground: 222.2 84% 4.9%;
    --_primary: var(--_muted);
    --_primary-foreground: var(--_muted-foreground);
    --_secondary: var(--_muted);
    --_secondary-foreground: 215.4 16.3% 70.9%;
    --_muted: 0 0% 100%;
    --_muted-foreground: var(--_foreground);
    --_accent: var(--_background);
    --_accent-foreground: 222.2 84% 4.9%;
    --_destructive: 0 84.2% 60.2%;
    --_destructive-foreground: var(--_background);
    --_border: 214.3 31.8% 91.4%;
    --_input: var(--_border);
    --_ring: 222.2 84% 4.9%;
    --_radius: 0.375rem;

    /* Status (light) */
    --_success: 142.1 76.2% 36.3%;
    --_success-foreground: 138.5 76.5% 96.7%;
    --_warning: 32.2 95% 44.1%;
    --_warning-foreground: 26 83.3% 14.1%;
    --_info: 217.2 91.2% 59.8%;
    --_info-foreground: 222.2 84% 4.9%;
    --_neutral: 210 40% 96%;
    --_neutral-foreground: 222.2 84% 4.9%;

    /* Console (light) */
    --_console-background: 0 0% 100%;
    --_console-foreground: 222.2 84% 4.9%;
    --_console-success: 138 69% 45%;
    --_console-error: 5 100% 69%;
  }

  /* Dark defaults (used if no theme class but user prefers dark) */
  .dark {
    color-scheme: dark;
    --_background: 48 4% 16%;
    --_foreground: 48 7% 85%;
    --_primary: var(--_muted);
    --_primary-foreground: var(--_muted-foreground);
    --_secondary: var(--_muted);
    --_secondary-foreground: 48 2% 65%;
    --_muted: 60 2% 18%;
    --_muted-foreground: var(--_foreground);
    --_accent: var(--_background);
    --_accent-foreground: 210 40% 98%;
    --_destructive: 0 45% 55%;
    --_destructive-foreground: var(--_background-foreground);
    --_border: 60 2% 25%;
    --_input: var(--_border);
    --_ring: 212.7 26.8% 83.9%;

    /* Status (dark) */
    --_success: 138.5 76.5% 47.7%;
    --_success-foreground: 138.5 76.5% 96.7%;
    --_warning: 32.2 95% 44.1%;
    --_warning-foreground: 26 83.3% 14.1%;
    --_info: 217.2 91.2% 59.8%;
    --_info-foreground: 222.2 84% 4.9%;
    --_neutral: 217.2 32.6% 17.5%;
    --_neutral-foreground: 210 40% 98%;

    /* Console (dark) */
    --_console-background: 0 0% 0%;
    --_console-foreground: 210 40% 98%;
    --_console-success: 138.5 76.5% 47.7%;
    --_console-error: 0 84.2% 60.2%;
  }
}

/* 2) PUBLIC TOKENS: prefer VS Code, else fall back to theme tokens */
@layer base {
  :root {
    --background: var(--vscode-editor-background, var(--_background));
    --foreground: var(--vscode-editor-foreground, var(--_foreground));

    --card: var(--muted);
    --card-foreground: var(--muted-foreground);
    /* Use muted color for popover to ensure solid background, fallback to background if muted is not available */
    --popover: var(--_muted, var(--_background));
    --popover-foreground: var(--foreground);

    --primary: var(--vscode-button-background, var(--_primary));
    --primary-foreground: var(
      --vscode-editor-foreground,
      var(--_primary-foreground)
    );
    --secondary: var(--vscode-input-background, var(--_secondary));
    --secondary-foreground: var(
      --vscode-input-foreground,
      var(--_secondary-foreground)
    );

    --muted: var(--vscode-editor-background, var(--_muted));
    --muted-foreground: var(
      --vscode-descriptionForeground,
      var(--_muted-foreground)
    );
    --accent: var(--vscode-focusBorder, var(--_accent));
    --accent-foreground: var(
      --vscode-editor-foreground,
      var(--_accent-foreground)
    );

    --destructive: var(--vscode-errorForeground, var(--_destructive));
    --destructive-foreground: var(
      --vscode-button-foreground,
      var(--_destructive-foreground)
    );

    --border: var(--vscode-input-background, var(--_border));
    --input: var(--vscode-input-background, var(--_input));
    --ring: var(--vscode-focusBorder, var(--_ring));

    --radius: var(--_radius);

    /* Status */
    --success: var(--vscode-testing-iconPassed, var(--_success));
    --success-foreground: var(
      --vscode-editor-foreground,
      var(--_success-foreground)
    );
    --warning: var(--vscode-testing-iconQueued, var(--_warning));
    --warning-foreground: var(
      --vscode-descriptionForeground,
      var(--_warning-foreground)
    );
    --info: var(--vscode-focusBorder, var(--_info));
    --info-foreground: var(--vscode-editor-foreground, var(--_info-foreground));
    --neutral: var(--vscode-input-background, var(--_neutral));
    --neutral-foreground: var(
      --vscode-editor-foreground,
      var(--_neutral-foreground)
    );

    /* Console/terminal */
    --console-background: var(
      --vscode-editor-background,
      var(--_console-background)
    );
    --console-foreground: var(
      --vscode-terminal-foreground,
      var(--_console-foreground)
    );
    --console-success: var(
      --vscode-testing-iconPassed,
      var(--_console-success)
    );
    --console-error: var(--vscode-terminal-ansiRed, var(--_console-error));
  }
}

/* ANSI color classes for fancy-ansi */
@layer components {
  .ansi-red {
    @apply text-red-500;
  }

  .ansi-green {
    @apply text-green-500;
  }

  .ansi-yellow {
    @apply text-yellow-500;
  }

  .ansi-blue {
    @apply text-blue-500;
  }

  .ansi-magenta {
    @apply text-purple-500;
  }

  .ansi-cyan {
    @apply text-cyan-500;
  }

  .ansi-white {
    @apply text-white;
  }

  .ansi-black {
    @apply text-black;
  }

  .ansi-bright-red {
    @apply text-red-400;
  }

  .ansi-bright-green {
    @apply text-green-400;
  }

  .ansi-bright-yellow {
    @apply text-yellow-400;
  }

  .ansi-bright-blue {
    @apply text-blue-400;
  }

  .ansi-bright-magenta {
    @apply text-purple-400;
  }

  .ansi-bright-cyan {
    @apply text-cyan-400;
  }

  .ansi-bright-white {
    @apply text-gray-200;
  }

  .ansi-bright-black {
    @apply text-gray-700;
  }

  .ansi-bold {
    @apply font-bold;
  }

  .ansi-italic {
    @apply italic;
  }

  .ansi-underline {
    @apply underline;
  }
}

/* BASIC STYLES (mainly for rendering markdown) */

@layer base {
  .wysiwyg {
    h1 {
      @apply text-lg leading-tight font-medium;
    }

    h2 {
      @apply leading-tight font-medium;
    }

    ul {
      @apply list-disc list-outside space-y-0.5 ps-5;
    }

    ol {
      @apply list-decimal list-outside space-y-0.5 ps-5;
    }

    li {
      @apply leading-tight;
    }
  }

  .markdown-content {
    color: hsl(var(--foreground));
    line-height: 1.5;

    h1 {
      @apply text-2xl font-bold mt-4 mb-2;
    }

    h2 {
      @apply text-xl font-semibold mt-3 mb-2;
    }

    h3 {
      @apply text-lg font-semibold mt-2 mb-1.5;
    }

    h4 {
      @apply text-base font-semibold mt-2 mb-1;
    }

    p {
      @apply mb-2;
    }

    ul {
      @apply list-disc list-outside space-y-1 ps-5 mb-2;
    }

    ol {
      @apply list-decimal list-outside space-y-1 ps-5 mb-2;
    }

    li {
      @apply leading-normal;
    }

    code {
      background-color: hsl(var(--muted));
      @apply px-1 py-0.5 text-sm font-mono;
    }

    pre {
      background-color: hsl(var(--muted));
      @apply p-2 overflow-x-auto mb-2;
    }

    pre code {
      @apply bg-transparent p-0;
    }

    blockquote {
      border-left: 4px solid hsl(var(--muted-foreground));
      @apply pl-3 italic my-2;
    }

    table {
      @apply w-full border-collapse mb-2;
    }

    th {
      border: 1px solid hsl(var(--border));
      background-color: hsl(var(--muted));
      @apply px-2 py-1 text-left font-semibold;
    }

    td {
      border: 1px solid hsl(var(--border));
      @apply px-2 py-1;
    }

    a {
      color: hsl(var(--primary));
      @apply underline;
    }

    a:hover {
      color: hsl(var(--primary) / 0.8);
    }

    img {
      @apply max-w-full h-auto my-2;
    }

    hr {
      border-top: 1px solid hsl(var(--border));
      @apply my-3;
    }

    mark {
      @apply bg-yellow-200 dark:bg-yellow-800 px-1;
    }

    .highlight-selected {
      background-color: hsl(var(--info) / 0.5) !important;
      @apply px-1;
      border: 2px solid hsl(var(--info));
    }

    .highlight-exclusion-requirement {
      background-color: hsl(var(--destructive) / 0.2);
      @apply px-1;
    }

    .highlight-evaluation-requirement {
      background-color: hsl(var(--info) / 0.2);
      @apply px-1;
    }

    .highlight-search {
      background-color: hsl(var(--warning) / 0.3);
      @apply px-1;
    }
  }
}

/* Ensure dialogs, tooltips, and dropdowns have solid backgrounds */
@layer utilities {
  /* Tooltip content should have solid background */
  [data-radix-tooltip-content] {
    background-color: hsl(var(--popover)) !important;
  }
  
  /* Dialog content should have solid background */
  [role="dialog"] {
    background-color: hsl(var(--background)) !important;
  }
  
  /* Dropdown menu content should have solid background */
  [data-radix-dropdown-menu-content],
  [data-radix-dropdown-menu-sub-content] {
    background-color: hsl(var(--popover)) !important;
  }
  
  /* Ensure bg-popover and bg-background classes work correctly */
  .bg-popover {
    background-color: hsl(var(--popover)) !important;
  }
  
  .bg-background {
    background-color: hsl(var(--background)) !important;
  }
}
